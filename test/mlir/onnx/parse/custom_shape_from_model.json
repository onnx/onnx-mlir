// RUN: onnx-mlir --EmitONNXIR --useOnnxModelTypes=false --useOnnxModelTypesForCustomOps=true --printIR %s | FileCheck %s
// RUN: onnx-mlir --EmitONNXIR --useOnnxModelTypes=false --useOnnxModelTypesForCustomOps=false --printIR %s | FileCheck %s --check-prefix=NO-TYPES-FROM-MODEL

// Json generated with utils/testing/custom_shape_from_model.py

// CHECK-LABEL:  func.func @main_graph
// CHECK-SAME:   ([[PARAM_0_:%.+]]: tensor<4x5xf32> {onnx.name = "X"}) -> (tensor<5x6xf32> {onnx.name = "Z"}) {
// CHECK:           [[VAR_0_:%.+]] = "onnx.Custom"([[PARAM_0_]]) {domain_name = "test", function_name = "MyCustomOp", onnx_node_name = "onnx.Custom_0"} : (tensor<4x5xf32>) -> tensor<5x6xf32>
// CHECK:           [[VAR_1_:%.+]] = "onnx.Relu"([[VAR_0_]]) {onnx_node_name = "onnx.Relu_1"} : (tensor<5x6xf32>) -> tensor<5x6xf32>
// CHECK:           return [[VAR_1_]] : tensor<5x6xf32>
// CHECK:         }
// NO-TYPES-FROM-MODEL-LABEL:  func.func @main_graph
// NO-TYPES-FROM-MODEL-SAME:   ([[PARAM_0_:%.+]]: tensor<4x5xf32> {onnx.name = "X"}) -> (tensor<5x6xf32> {onnx.name = "Z"}) {
// NO-TYPES-FROM-MODEL:           [[VAR_0_:%.+]] = "onnx.Custom"([[PARAM_0_]]) {domain_name = "test", function_name = "MyCustomOp", onnx_node_name = "onnx.Custom_0"} : (tensor<4x5xf32>) -> tensor<*xf32>
// NO-TYPES-FROM-MODEL:           [[VAR_1_:%.+]] = "onnx.Relu"([[VAR_0_]]) {onnx_node_name = "onnx.Relu_1"} : (tensor<*xf32>) -> tensor<5x6xf32>
// NO-TYPES-FROM-MODEL:           return [[VAR_1_]] : tensor<5x6xf32>
// NO-TYPES-FROM-MODEL:         }
{
  "irVersion": "10",
  "producerName": "onnx-mlir",
  "graph": {
    "node": [
      {
        "input": [
          "X"
        ],
        "output": [
          "Y"
        ],
        "opType": "MyCustomOp",
        "domain": "test"
      },
      {
        "input": [
          "Y"
        ],
        "output": [
          "Z"
        ],
        "opType": "Relu"
      }
    ],
    "name": "test-custom",
    "input": [
      {
        "name": "X",
        "type": {
          "tensorType": {
            "elemType": 1,
            "shape": {
              "dim": [
                {
                  "dimValue": "4"
                },
                {
                  "dimValue": "5"
                }
              ]
            }
          }
        }
      }
    ],
    "output": [
      {
        "name": "Z",
        "type": {
          "tensorType": {
            "elemType": 1,
            "shape": {
              "dim": [
                {
                  "dimValue": "5"
                },
                {
                  "dimValue": "6"
                }
              ]
            }
          }
        }
      }
    ],
    "valueInfo": [
      {
        "name": "Y",
        "type": {
          "tensorType": {
            "elemType": 1,
            "shape": {
              "dim": [
                {
                  "dimValue": "5"
                },
                {
                  "dimValue": "6"
                }
              ]
            }
          }
        }
      }
    ]
  },
  "opsetImport": [
    {
      "domain": "",
      "version": "22"
    },
    {
      "domain": "test",
      "version": "1"
    }
  ]
}